# Database Setup and Management

This project uses [Neon](https://neon.tech/) as the PostgreSQL database provider and [Drizzle ORM](https://orm.drizzle.team/) for database operations.

## Database Structure

The database schema is defined in `db/schema.ts` and includes the following tables:

- `reports`: Stores analysis results generated by the application
- `users`: Stores user information (for future authentication)
- `user_reports`: Relationship table connecting users to their reports

## Setup Instructions

### 1. Environment Configuration

Ensure your `.env.local` file contains the Neon database connection string:

```
DB=postgresql://username:password@hostname/database?sslmode=require
```

### 2. Generate Migrations

To generate database migrations based on your schema changes:

```bash
npm run db:generate
```

This will create migration files in the `db/migrations` directory.

### 3. Apply Migrations

To apply the migrations to your database:

```bash
npm run db:migrate
```

### 4. View Database Schema

To view your database schema using Drizzle Studio:

```bash
npm run db:studio
```

## Usage in Application

To use the database in your application, import the `db` instance and schema from the appropriate files:

```typescript
import { db } from '../../../db';
import { reports } from '../../../db/schema';

// Example: Query reports
const allReports = await db.select().from(reports);

// Example: Insert a new report
const newReport = await db.insert(reports).values({
  title: 'Market Analysis',
  type: 'market',
  content: { /* report content */ },
}).returning();
```

## Testing the Connection

Visit the `/db-test` route in your application to test the database connection.